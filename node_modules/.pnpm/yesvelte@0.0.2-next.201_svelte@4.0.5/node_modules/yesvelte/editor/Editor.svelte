<script>import { createEventDispatcher, onMount } from "svelte";
import { El } from "../el";
import { Textarea } from "../textarea";
import { get_current_component } from "svelte/internal";
export let componentName = "editor";
export let value = void 0;
export let placeholder = void 0;
export let readonly = void 0;
export let height = "md";
export let name = void 0;
export let state = void 0;
export let toolbar = [
  { header: [1, 2, 3, 4, 5, 6, false] },
  "bold",
  "italic",
  "underline",
  "strike",
  "blockquote",
  "code-block"
];
const components = [
  { component: get_current_component(), except: ["changed"] },
  ...$$props.components ?? []
];
const dispatch = createEventDispatcher();
let element;
let instance;
let loaded = false;
$: {
  if (instance && value !== instance.root.innerHTML) {
    instance.root.innerHTML = value ?? "";
  }
}
let options = {};
$:
  options = {
    theme: "snow",
    placeholder,
    readOnly: readonly,
    modules: {
      toolbar
    }
  };
function onChange(event) {
  value = instance.root.innerHTML;
  dispatch("changed", value);
}
onMount(() => {
  import("quill").then((Quill) => {
    if (element && options) {
      instance = new Quill.default(element, options);
      instance.on("text-change", onChange);
      loaded = true;
    }
  });
  return () => {
    if (instance) {
      instance.off("text-change", onChange);
      loaded = false;
    }
  };
});
$:
  cssProps = {
    height,
    loaded,
    state
  };
</script>

<El {components} {cssProps} componentName="{componentName}-wrapper">
	<El {componentName} bind:element />
</El>

<!-- This can be used inside forms which has value of the editor -->
<Textarea bind:value d="none" {name} />
