<script>import { get_current_component } from "svelte/internal";
import { El } from "../el";
export let componentName = "floating";
export let fixed;
export let offset = 0;
export let placement = "end-bottom";
const components = [
  { component: get_current_component(), except: [] },
  ...$$props.components ?? []
];
let element;
let cssProps = {};
let props = {};
$:
  cssProps = { fixed };
$:
  props = { componentName };
$:
  (() => {
    if (!element)
      return;
    if (typeof window != "object")
      return;
    const rtl = getComputedStyle(element).getPropertyValue("direction").toLowerCase() == "rtl";
    let p = placement || "";
    if (p.match(/^(top|bottom)$/))
      p = `-${p}`;
    let [x, y] = p.split("-");
    x ||= "center";
    y ||= "center";
    if (x.match(/start/))
      x = rtl ? "right" : "left";
    if (x.match(/end/))
      x = rtl ? "left" : "right";
    const centeredX = x == "center";
    const centeredY = y == "center";
    const X = !centeredX ? x : rtl ? "right" : "left";
    const Y = !centeredY ? y : "top";
    const offsets = [offset].flat().map((offset2) => typeof offset2 == "number" ? `${offset2}px` : offset2);
    const offsetX = offsets[0];
    const offsetY = offsets[1] ?? offsets[0];
    const style = {};
    style[X] = centeredX ? `calc(50% + ${offsetX})` : `calc(0px + ${offsetX})`;
    style[Y] = centeredY ? `calc(50% + ${offsetY})` : `calc(0px + ${offsetY})`;
    if (centeredX || centeredY) {
      style["transform"] = `translate(${centeredX ? `${rtl ? "" : "-"}50%` : "0"}, ${centeredY ? "-50%" : "0"})`;
    }
    requestAnimationFrame(() => Object.assign(element.style, style));
  })();
</script>

<El {components} bind:element {...$$restProps} {cssProps} {...props}>
	<slot />
</El>
